---
icon: octicons/feed-trophy-16
---

# IAM Privilege Escalation Tactics

## `iam:CreateAccessKey`

### Example vulnerable policy

```
Operations:
    Type: AWS::IAM::Group
    Properties:
      GroupName: Operations
      Policies: 
        - PolicyName: OperationsPolicy
          PolicyDocument: 
            Version: '2012-10-17'
            Statement:
              - Effect: Allow
                Action:
                  - "iam:CreateAccessKey"
                Resource: '*'
```

Users in this `Operations` group have access to create access keys for all users in this AWS environment because of `Resource: '*'`, even for administrators.

### Example exploit

```
aws iam create-access-key \
    --user-name <victim-username> \
    --output text | tee creds.txt
```

This will output the access key and you can always retrieve with:

```
cat creds.txt
```


### Impact

The potential impact of this attack is anything from getting access to a low-privileged IAM user all the way to gaining admin privileges, depending on which user the threat actor is able to create access keys for. 

### How to prevent

Prevent the creation of any new keys in all of your AWS environments with SCPs. This can be a drastic solution for some organizations who still rely on long-term access keys, however, it is a good goal to strive towards as [outlined here](/aws/iam/get-rid-of-access-keys/). 

For organizations who simply can't yet get rid of long-term access keys, recommendations are to:

- Limit access key creation to higher privileged users only, or
- Ensure that users can _only create keys for their own users_

This issue is primarily a concern when 1 user has `iam:CreateAccessKey` permissions for another user as well.

## `iam:CreateLoginProfile`

### Example vulnerable policy

```
Operations:
    Type: AWS::IAM::Group
    Properties:
      GroupName: Operations
      Policies: 
        - PolicyName: OperationsPolicy
          PolicyDocument: 
            Version: '2012-10-17'
            Statement:
              - Effect: Allow
                Action:
                  - "iam:CreateLoginProfile"
                Resource: 'arn:aws:iam::123456789012:user/*'

```

Users in this `Operations` group have access to create login profiles with whatever password they want (within the AWS account's password policy allowance) for all users in this AWS environment because of `Resource: 'arn:aws:iam::123456789012:user/*'`, even for administrators.

### Example exploit

```
aws iam create-login-profile --user-name <victim-username> \ 
    --password '<arbitrary-password-here>' \
    --no-password-reset-required
```

Which returns:

```
{
    "LoginProfile": {
        "UserName": "<victim-username>",
        "CreateDate": "2023-11-30T21:46:56+00:00",
        "PasswordResetRequired": false
    }
}
```

Note that this action will only work if the IAM user does not already have a login profile. Otherwise, you can try to use `iam:UpdateLoginProfile`.


### Impact

The potential impact of this attack is anything from getting access to a low-privileged IAM user all the way to gaining admin privileges, depending on which user the threat actor is able to create a login profile for. 

### How to prevent

The best way to prevent this issue is to stop using IAM Users altogether and instead use [IAM Identity Center](/aws/iam/identity-center/). This can be a drastic step for some organizations, however. As an alternative, if you have to grant this permission, make sure it only gives users the ability to create their own login profile only (unless they're an admin user who's meant to be able to do this).

## `iam:UpdateLoginProfile`

Exactly the same details as the above `iam:CreateLoginProfile` except the permission is `iam:UpdateLoginProfile` and the command is different:

```
aws iam update-login-profile --user-name <victim-username> \
    --password '<arbitrary-password-here>' \
    --no-password-reset-required 
```

## `iam:SetDefaultPolicyVersion`

### Impact

### How to prevent

## `iam:AddUserToGroup`

### Impact

### How to prevent

## `iam:AttachUserPolicy`

### Impact

### How to prevent

## `iam:AttachGroupPolicy`

### Impact

### How to prevent

## `iam:PutUserPolicy`

### Impact

### How to prevent

## `iam:PutGroupPolicy`

### Impact

### How to prevent

## `iam:AttachRolePolicy`

### Impact

### How to prevent

## `iam:PutRolePolicy`

### Impact

### How to prevent

## `iam:DeactivateMFADevice`

### Impact

### How to prevent

## How to detect these PrivEscs in your environments

Coming soon

## Additional Resources

<iframe width="560" height="315" src="https://www.youtube.com/embed/vGTPtJNFCMc?si=spvLP00uw1gcZCGq" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

- Learn about most of these PrivEscs hands-on from our sponsor's course: [ :octicons-link-external-16: IAM Privilege Escalation Labs](https://cybr.com/courses/iam-privilege-escalation-labs/)^[Free&Paid]^ ^[Sponsored]^ _(Some of the labs are free and others require a paid membership)_